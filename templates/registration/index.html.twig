{% extends 'base.html.twig' %}

{% block title %}Hello RegistrationController!{% endblock %}
{% block stylesheets %}
<link href={{ asset('css/stylesheet.css') }} rel="stylesheet">
<link href={{ asset('css/colors.css') }} rel="stylesheet">
{% endblock %}


{% block body %}
<link rel="stylesheet" href={{ asset('css/registration.css') }}>

{% block header %}
    {% include "mqbaka_home/header-compact.html.twig" %}
{% endblock %}

<div class="form-register">
    <div class="background">
        <img src={{ asset('images/favicon.png') }} alt="">
    </div>
    <div class="inner-bg">
        <div class="the-img">
            <img src={{ asset('images/vectors/19.png') }} alt="">
        </div>
        
        {{ form_start(form, {'attr': {'id': 'registration-form'}}) }}
        
        {#% Flash message %#}
        {% for message in app.flashes('danger') %}
            <div class="alert alert-danger">
                {{ message }}
            </div>
        {% endfor %}
        
        <!-- Data to test with Javascript -->
        <div class="js-price-id" data-price-id="{{ priceId ? priceId : null }}"></div>
        <div class="form-container">
                <div class="double-line">
                    <div class="line">
                        {{ form_widget(form.nom) }}
                    </div>
                    <div class="line">
                        {{ form_widget(form.prenom) }}
                    </div>
                </div>

                <div class="double-line">
                    <div class="line">
                        {{ form_widget(form.nomEntreprise) }}
                    </div>
                    <div class="line">
                        {{ form_widget(form.email) }}
                    </div>
                </div>

                <div class="double-line">
                    <div class="line">
                        {{ form_widget(form.telMobile) }}
                    </div>
                    <div class="line">
                        {{ form_widget(form.telFixe) }}
                    </div>
                </div>

                <div class="double-line">
                    <div class="line">
                        {{ form_widget(form.password.first) }}
                    </div>
                    <div class="line">
                        {{ form_widget(form.password.second) }}
                    </div>
                </div>

                <div class="double-line">
                    <div class="line">
                        {{ form_widget(form.siren) }}
                    </div>
                    <div class="line">
                        {{ form_widget(form.address) }}
                    </div>
                </div>
                <div class="line" style="text-align:center;">
                    <!-- div class="line" -->
                        {{ form_row(form.type_abonnement) }}
                    <!-- /div -->
                </div>
                <div class="line line-essentiel">
                    {{ form_widget(form.rib) }}
                </div>
                <div class="double-line">
                    <div class="line line-essentiel" style="text-align:center;">
                        <!-- div class="line" -->
                        <!-- /div -->
                        <div class="fileDiv">
                            <!-- label for="custom-identityProofFilename" id="custom-identityProofFilename-label"></label -->
                            <button type="button" id="custom-identityProofFile">Pièce d'identité</button>
                            <span id="custom-identityProofFilename">Aucun fichier choisi</span>
                            {{ form_widget(form.identityProofFile) }}
                            <div id="identityProofInfos"></div>
                        </div>
                    </div>
                    <div class="line line-essentiel" style="text-align:center;">
                        <!-- div class="line" -->
                        <!-- /div -->
                        <div class="fileDiv">
                            <!-- label for="custom-identityProofFilename" id="custom-identityProofFilename-label"></label -->
                            <button type="button" id="extraitRCSFile">Extrait RCS</button>
                            <span id="extraitRCSfilename">Aucun fichier choisi</span>
                            {{ form_widget(form.extraitRCSFile) }}
                        </div>
                    </div>
                </div>
                <button type="submit" id="registrationSubmit">Inscription</button>
        </div>
        {{ form_end(form) }}

    </div>
</div>

{% endblock %}

{% block javascripts %}
    <script>

        document.addEventListener('DOMContentLoaded', function() {
            const priceIdElement = document.querySelector('.js-price-id');
            const priceId = priceIdElement.dataset.priceId;
            const selectOptions = document.getElementsByTagName('option');
            const optionsArray = Array.from(selectOptions);

            for (let option of optionsArray) {
                if(option.value == priceId){
                    option.selected='selected';
                }
            }
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded',() => {
            const priceIdElement = document.querySelector('.js-price-id');
            const priceId = priceIdElement.dataset.priceId;
            const client_type_abonnement = document.querySelector('#client_type_abonnement');
            
            const realFileBtn = document.querySelector('#client_identityProofFile');
            const customBtn = document.querySelector('#custom-identityProofFile');
            const identityProofFilename = document.querySelector('#custom-identityProofFilename');

            const client_extraitRCSFile = document.querySelector('#client_extraitRCSFile');
            const extraitRCSFileBtn = document.querySelector('#extraitRCSFile');
            const extraitRCSfilename = document.querySelector('#extraitRCSfilename');

            console.log(priceId);

            const everyLineEssentiel = Array.from(document.querySelectorAll('.line-essentiel'));
            //Affichage des champs pièces jointes en fonction de l'abonnement choisi auparavant    
            if (priceId == 'price_1JT0YJBW8SyIFHAgmEuizs6Z' || priceId == 'price_1JWc3mBW8SyIFHAg2E4YGU4c') {
                everyLineEssentiel.forEach(element => {
                    element.style.display = 'inline';
                });
                //document.querySelector('.line-essentiel').style.display = 'inline';
                //client_identityProofFile.required = true;
            } else if(priceId == 'price_1JWc1BBW8SyIFHAgvuKoItbD' || priceId == 'price_1JWc1oBW8SyIFHAgGnAmvtyw') {
                everyLineEssentiel.forEach(element => {
                    element.style.display = 'none';
                });
                //document.querySelector('.line-essentiel').style.display = 'none';
                //client_identityProofFile.required = false;
            } else {
                everyLineEssentiel.forEach(element => {
                    element.style.display = 'none';
                });
                //document.querySelector('.line-essentiel').style.display = 'none';
                //client_identityProofFile.required = false;
            }

            //"Mise en forme du champ pièce d'identité. "   
            customBtn.addEventListener('click', () => {
                realFileBtn.click();
            });

            realFileBtn.addEventListener('change', () => {
                if (realFileBtn.value) {
                    identityProofFilename.innerHTML = realFileBtn.value.match(/[\/\\]([\w\d\s\.\-\(\)]+)$/)[1];
                } else {
                    identityProofFilename.innerHTML = 'Aucun fichier choisi';
                }
            })
            
            //"Mise en forme du champ pièce d'identité. "   
            extraitRCSFileBtn.addEventListener('click', () => {
                client_extraitRCSFile.click();
            });

            client_extraitRCSFile.addEventListener('change', () => {
                if (client_extraitRCSFile.value) {
                    extraitRCSfilename.innerHTML = client_extraitRCSFile.value.match(/[\/\\]([\w\d\s\.\-\(\)]+)$/)[1];
                } else {
                    extraitRCSfilename.innerHTML = 'Aucun fichier choisi';
                }
            })
            
            //Affichage des champs pièces jointes en fonction de la valeur du select choisie sur la page    
            client_type_abonnement.addEventListener('change', () => {
                if(client_type_abonnement.value == 'price_1JT0YJBW8SyIFHAgmEuizs6Z' || client_type_abonnement.value == 'price_1JWc3mBW8SyIFHAg2E4YGU4c'){
                    everyLineEssentiel.forEach(element => {
                        element.style.display = 'inline';
                    });
                    //document.querySelector('.line-essentiel').style.display = 'inline';
                    //client_identityProofFile.required = true;
                } else if(client_type_abonnement.value == 'price_1JWc1BBW8SyIFHAgvuKoItbD' || client_type_abonnement.value == 'price_1JWc1oBW8SyIFHAgGnAmvtyw') {
                    everyLineEssentiel.forEach(element => {
                        element.style.display = 'none';
                    });
                    //document.querySelector('.line-essentiel').style.display = 'none';
                    //client_identityProofFile.required = false;
                };
            });
        });
    </script>
{% endblock %}
